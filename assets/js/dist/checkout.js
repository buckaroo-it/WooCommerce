/*! For license information please see checkout.js.LICENSE.txt */
(()=>{"use strict";var e;!function(e){!function(e){var t;e.validateCardNumber=function(e,t){if(null==e)return!1;if(/[^0-9]+/.test(e))return!1;if(e.length<10||e.length>19)return!1;for(var a=0,r=0;r<e.length;r++){var n=parseInt(e.charAt(r),10);r%2==e.length%2&&(n*=2)>9&&(n-=9),a+=n}if(a%10!=0)return!1;if(null==t)return!0;switch(t.toLowerCase()){case"visa":case"visaelectron":case"vpay":case"cartebleuevisa":case"dankort":return/^4[0-9]{12}(?:[0-9]{3})?$/.test(e);case"postepay":case"mastercard":return/^(5[1-5]|2[2-7])[0-9]{14}$/.test(e);case"bancontactmrcash":case"bancontact":return/^(4796|6060|6703|5613|5614)[0-9]{12,15}$/.test(e);case"maestro":return/^\d{12,19}$/.test(e);case"amex":case"americanexpress":return/^3[47][0-9]{13}$/.test(e);case"cartebancaire":case"cartasi":return/^((5[1-5]|2[2-7])[0-9]{14})|(4[0-9]{12}(?:[0-9]{3})?)$/.test(e);default:return!1}},e.validateCvc=function(e,t){if(null==e)return!1;if(null==t){if(0===e.length)return!0;if(3!==e.length&&4!==e.length)return!1}else switch(t.toLowerCase()){case"bancontactmrcash":case"bancontact":case"maestro":return 0===e.length;case"amex":case"americanexpress":if(4!==e.length)return!1;break;default:if(3!==e.length)return!1}return!/[^0-9]+/.test(e)},e.validateYear=function(e){return null!=e&&!/[^0-9]+/.test(e)&&(2===e.length||4===e.length)},e.validateMonth=function(e){if(null==e)return!1;if(/[^0-9]+/.test(e))return!1;if(1!==e.length&&2!==e.length)return!1;var t=parseInt(e);return!(t<1||t>12)},e.validateCardholderName=function(e){return null!=e&&!(null==(t=e)||t.replace(/\s/g,"").length<1);var t},function(e){e.algorithm="RSA-OAEP",e.hashName="SHA-1",e.exponent="AQAB",e.keyType="RSA",e.modulus="4NdLa7WIq-ygcTo4tGFu8ec7qRwtZ1jLEjKntXfs56gaWtaYSxc-er7ljG22rbv41T5raYfdzvPqV3YcTFCOLpdJIJkzTvorY-IDR09kN6uHKGutSjdkDpYrKFHeU_x0W7P0GUW2Sc14B7G_L8C2eMSqkDAMtANyvOCHdk_2chYOgYqIuZfInTaNEzHbYb6i-D5sKeu1D15G2uEFY-gkuLmtDq3xPUzK_G-haG4KsIL5JKbt-kV3_Dibu3OUpiMDN1YpocqaUR5soFmKiJi1PHtgQZ0aydXxveHIRhtE-5FgL7w307gOqbMJ4q3fXDAZQzKBwlNYnwgAaFW1PSzk9w",e.version="001",e.keyFormat="jwk",e.keyOperations=["encrypt"],e.publicKeyData={alg:e.algorithm,e:e.exponent,ext:!0,kty:e.keyType,n:e.modulus},e.algorithmParams={name:e.algorithm,hash:{name:e.hashName}}}(t||(t={}));var a=function(e){return btoa(String.fromCharCode.apply(null,e))},r=function(e,t,a,r,n){for(var o=unescape(encodeURIComponent(e+","+t+","+a+","+r+","+n)),l=[],i=0;i<o.length;i++)l.push(o.charCodeAt(i));return new Uint8Array(l)};e.encryptCardDataOther=function(e,n,o,l,i){var u=r(e,n,o,l,i);return window.crypto.subtle.importKey(t.keyFormat,t.publicKeyData,t.algorithmParams,!0,t.keyOperations).then((function(e){return window.crypto.subtle.encrypt(t.algorithmParams,e,u.buffer).then((function(e){var r=new Uint8Array(e),n=a(r);return t.version+n}),(function(e){console.log(e)}))}),(function(e){console.log(e)}))},e.encryptCardDataIE=function(e,n,o,l,i,u){for(var c=(window.crypto||window.msCrypto).subtle,s=r(e,n,o,l,i),y={publicKey:'{ \t\t\t\t\t"kty" : "'+t.keyType+'", \t\t\t\t\t"extractable" : true, \t\t\t\t\t"n" : "'+t.modulus+'", \t\t\t\t\t"e" : "'+t.exponent+'", \t\t\t\t\t"alg" : "'+t.algorithm+'" \t\t\t\t}'},g=new Uint8Array(y.publicKey.length),b=0;b<y.publicKey.length;b+=1)g[b]=y.publicKey.charCodeAt(b);var d=c.importKey(t.keyFormat,g,t.algorithmParams,!0,t.keyOperations);d.onerror=function(e){console.error(e)},d.oncomplete=function(e){var r=e.target.result,n=c.encrypt(t.algorithmParams,r,s.buffer);n.onerror=function(e){console.error(e)},n.oncomplete=function(e){var r=new Uint8Array(e.target.result),n=a(r),o=t.version+n;u(o)}}},e.encryptCardData=function(t,a,r,n,o,l){window.navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./)?e.encryptCardDataIE(t,a,r,n,o,l):e.encryptCardDataOther(t,a,r,n,o).then((function(e){l(e)}),(function(e){console.log(e)}))}}(e.V001||(e.V001={}))}(e||(e={}));const t=e;jQuery((function(){(new class{listen(){let e=this;e.paybyBank(),jQuery("body").on("change",'input[name="payment_method"]',(function(){jQuery("body").trigger("update_checkout")})),jQuery("body").on("updated_checkout",(function(t){e.afterpay(),e.afterpaynew(),e.bilink(),e.klarna(),e.initPayByBank()})),jQuery("#billing_company").on("input",(function(){e.bilink_toggle(jQuery(this).val()),jQuery("#buckaroo-afterpaynew-coc").parent().toggle(0!==jQuery.trim(jQuery(this).val()).length)})),jQuery("body").on("change","#buckaroo-afterpay-b2b",(function(){let e=jQuery(this).is(":checked"),t=jQuery("#buckaroo-afterpay-birthdate"),a=t.parent(),r=jQuery('[name="buckaroo-afterpay-gender"]'),n=r.parent();jQuery("#showB2BBuckaroo").toggle(e),jQuery("#billing_company").length&&jQuery("#buckaroo-afterpay-CompanyName").val(jQuery("#billing_company").val()),t.prop("disabled",!e),a.toggle(!e),a.toggleClass("validate-required",!e),r.prop("disabled",!e),n.toggle(!e)}))}afterpay(){jQuery("input[name=billing_phone]").length&&jQuery("#buckaroo-afterpay-phone").parent().hide()}afterpaynew(){jQuery("input[name=billing_phone]").length&&jQuery("#buckaroo-afterpaynew-phone").parent().hide(),jQuery("#buckaroo-afterpaynew-coc").parent().toggle(0!==jQuery.trim(jQuery("input[name=billing_company]").val()).length)}bilink(){let e=jQuery("#billing_company");e.length&&this.bilink_toggle(e.val())}bilink_toggle(e){let t=jQuery("#buckaroo_billink_b2b"),a=jQuery("#buckaroo_billink_b2c");if(t.length&&a.length){var r=jQuery.trim(e).length>0;t.toggle(r),a.toggle(!r)}}klarna(){jQuery("input[name=billing_phone]").length&&jQuery('input[id^="buckaroo-klarna"][type="tel"]').parent().hide()}paybyBank(){this.initPayByBank();const e=this;jQuery("body").on("change",".bk-paybybank-radio",(function(){let t=jQuery(".bk-paybybank-radio:checked").val();jQuery(".bk-paybybank-real-value, .buckaroo-paybybank-select").val(t),e.setPayByBankLogo()})),jQuery("body").on("change",".buckaroo-paybybank-select",(function(){let t=jQuery(this).val();jQuery(".bk-paybybank-real-value").val(t),e.setPayByBankLogo(),e.setRadioSelectedFromRealValue()})),jQuery("body").on("click",".bk-toggle-wrap",(function(){const t=jQuery(".bk-toggle"),a=jQuery(".bk-toggle-text"),r=t.is(".bk-toggle-down");t.toggleClass("bk-toggle-down bk-toggle-up");const n=a.attr("text-less"),o=a.attr("text-more");r?a.text(n):a.text(o),e.getElementToToggle().toggle(r)}));let t=!1;jQuery(window).on("resize",(function(){let e=jQuery(window).width()<768;t!==e&&(t=e,jQuery(".bk-paybybank-mobile").toggle(t),jQuery(".bk-paybybank-not-mobile").toggle(!t))}))}setRadioSelectedFromRealValue(){const e=jQuery('.bk-paybybank-radio[value="'+jQuery(".bk-paybybank-real-value").val()+'"]');e.length&&(jQuery(".bk-toggle").removeClass("bk-toggle-up").addClass("bk-toggle-down"),jQuery(".bk-toggle-text").text(jQuery(".bk-toggle-text").attr("text-more")),jQuery(".custom-radio").hide(),e.closest(".custom-radio").show(),e.prop("checked",!0))}setPayByBankLogo(){const e=jQuery(".bk-paybybank-real-value").val();buckaroo_global.payByBankLogos&&e.length&&buckaroo_global.payByBankLogos[e]&&jQuery(".payment_method_buckaroo_paybybank > label > img").prop("src",buckaroo_global.payByBankLogos[e])}initPayByBank(){this.setPayByBankLogo();let e=jQuery(window).width()<768;e&&(jQuery(".bk-paybybank-mobile").toggle(e),jQuery(".bk-paybybank-not-mobile").toggle(!e)),this.getElementToToggle().hide()}getElementToToggle(){return jQuery(".bank-method-input:checked").length>0?jQuery(".bank-method-input:not(:checked)").closest(".custom-radio"):jQuery(".bk-paybybank-selector .custom-radio:nth-child(n+5)")}}).listen(),(new class{form=jQuery("form[name=checkout]");validator=t.V001;listen(){let e=this.validator,t=this;this.form.on("input",".cardNumber",(function(a){t.toggleClasses(e.validateCardNumber(a.target.value),a.target)})),this.form.on("input",".cvc",(function(a){t.toggleClasses(e.validateCvc(a.target.value),a.target)})),this.form.on("input",".cardHolderName",(function(a){t.toggleClasses(e.validateCardholderName(a.target.value),a.target)})),this.form.on("input",".expirationYear",(function(a){t.toggleClasses(e.validateYear(a.target.value),a.target)})),this.form.on("input",".expirationMonth",(function(a){t.toggleClasses(e.validateMonth(a.target.value),a.target)})),this.form.submit(this.submit.bind(this))}toggleClasses(e,t){(t=jQuery(t)).toggleClass("error",!e),t.toggleClass("validated",e),this.submit()}submit(e){let a=jQuery('input[name="payment_method"]:checked').parent(),r=a.find(".cardNumber").val(),n=a.find(".cvc").val(),o=a.find(".cardHolderName").val(),l=a.find(".expirationYear").val(),i=a.find(".expirationMonth").val(),u=t.V001.validateCardNumber(r),c=t.V001.validateCvc(n),s=t.V001.validateCardholderName(o),y=t.V001.validateYear(l),g=t.V001.validateMonth(i);u&&c&&s&&y&&g&&this.getEncryptedData(r,l,i,n,o,a)}getEncryptedData(e,a,r,n,o,l){t.V001.encryptCardData(e,a,r,n,o,(function(e){l.find(".encryptedCardData").val(e)}))}}).listen(),(new class{listen(){const e=this;jQuery("#buckaroo-idin-verify-button").click((()=>{jQuery("#buckaroo-idin-issuer")&&jQuery("#buckaroo-idin-issuer").val().length>1?e.identify(jQuery("#buckaroo-idin-issuer").val()):e.displayErrorMessage(buckaroo_global.idin_i18n.bank_required)}))}disableBlock(e){jQuery(e).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}identify(e){const t=this;t.disableBlock(".checkout.woocommerce-checkout"),jQuery.ajax({url:buckaroo_global.ajax_url,data:{"wc-api":"WC_Gateway_Buckaroo_idin-identify",issuer:e},dataType:"json"}).done((e=>{jQuery(".woocommerce-checkout").unblock(),e&&e.message?t.displayErrorMessage(e.message):e&&"success"==e.result?window.location.replace(e.redirect):t.displayErrorMessage(buckaroo_global.idin_i18n.general_error)})).fail((()=>{t.displayErrorMessage(buckaroo_global.idin_i18n.general_error),jQuery(".woocommerce-checkout").unblock()}))}displayErrorMessage(e){const t=`      \n        <div class="woocommerce-error" role="alert">\n          ${e}\n        </div>\n      `;jQuery(".woocommerce-notices-wrapper").first().prepend(t);var a=jQuery(".woocommerce-notices-wrapper .woocommerce-error").first();setTimeout((function(){a.fadeOut(1e3)}),1e4),jQuery("html, body").scrollTop(0)}}).listen()}))})();