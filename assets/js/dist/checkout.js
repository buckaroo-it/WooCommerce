/*! For license information please see checkout.js.LICENSE.txt */
(()=>{"use strict";var e;!function(e){!function(e){var t;e.validateCardNumber=function(e,t){if(null==e)return!1;if(/[^0-9]+/.test(e))return!1;if(e.length<10||e.length>19)return!1;for(var r=0,a=0;a<e.length;a++){var n=parseInt(e.charAt(a),10);a%2==e.length%2&&(n*=2)>9&&(n-=9),r+=n}if(r%10!=0)return!1;if(null==t)return!0;switch(t.toLowerCase()){case"visa":case"visaelectron":case"vpay":case"cartebleuevisa":case"dankort":return/^4[0-9]{12}(?:[0-9]{3})?$/.test(e);case"postepay":case"mastercard":return/^(5[1-5]|2[2-7])[0-9]{14}$/.test(e);case"bancontactmrcash":case"bancontact":return/^(4796|6060|6703|5613|5614)[0-9]{12,15}$/.test(e);case"maestro":return/^\d{12,19}$/.test(e);case"amex":case"americanexpress":return/^3[47][0-9]{13}$/.test(e);case"cartebancaire":case"cartasi":return/^((5[1-5]|2[2-7])[0-9]{14})|(4[0-9]{12}(?:[0-9]{3})?)$/.test(e);default:return!1}},e.validateCvc=function(e,t){if(null==e)return!1;if(null==t){if(0===e.length)return!0;if(3!==e.length&&4!==e.length)return!1}else switch(t.toLowerCase()){case"bancontactmrcash":case"bancontact":case"maestro":return 0===e.length;case"amex":case"americanexpress":if(4!==e.length)return!1;break;default:if(3!==e.length)return!1}return!/[^0-9]+/.test(e)},e.validateYear=function(e){return null!=e&&!/[^0-9]+/.test(e)&&(2===e.length||4===e.length)},e.validateMonth=function(e){if(null==e)return!1;if(/[^0-9]+/.test(e))return!1;if(1!==e.length&&2!==e.length)return!1;var t=parseInt(e);return!(t<1||t>12)},e.validateCardholderName=function(e){return null!=e&&!(null==(t=e)||t.replace(/\s/g,"").length<1);var t},function(e){e.algorithm="RSA-OAEP",e.hashName="SHA-1",e.exponent="AQAB",e.keyType="RSA",e.modulus="4NdLa7WIq-ygcTo4tGFu8ec7qRwtZ1jLEjKntXfs56gaWtaYSxc-er7ljG22rbv41T5raYfdzvPqV3YcTFCOLpdJIJkzTvorY-IDR09kN6uHKGutSjdkDpYrKFHeU_x0W7P0GUW2Sc14B7G_L8C2eMSqkDAMtANyvOCHdk_2chYOgYqIuZfInTaNEzHbYb6i-D5sKeu1D15G2uEFY-gkuLmtDq3xPUzK_G-haG4KsIL5JKbt-kV3_Dibu3OUpiMDN1YpocqaUR5soFmKiJi1PHtgQZ0aydXxveHIRhtE-5FgL7w307gOqbMJ4q3fXDAZQzKBwlNYnwgAaFW1PSzk9w",e.version="001",e.keyFormat="jwk",e.keyOperations=["encrypt"],e.publicKeyData={alg:e.algorithm,e:e.exponent,ext:!0,kty:e.keyType,n:e.modulus},e.algorithmParams={name:e.algorithm,hash:{name:e.hashName}}}(t||(t={}));var r=function(e){return btoa(String.fromCharCode.apply(null,e))},a=function(e,t,r,a,n){for(var o=unescape(encodeURIComponent(e+","+t+","+r+","+a+","+n)),i=[],l=0;l<o.length;l++)i.push(o.charCodeAt(l));return new Uint8Array(i)};e.encryptCardDataOther=function(e,n,o,i,l){var u=a(e,n,o,i,l);return window.crypto.subtle.importKey(t.keyFormat,t.publicKeyData,t.algorithmParams,!0,t.keyOperations).then((function(e){return window.crypto.subtle.encrypt(t.algorithmParams,e,u.buffer).then((function(e){var a=new Uint8Array(e),n=r(a);return t.version+n}),(function(e){console.log(e)}))}),(function(e){console.log(e)}))},e.encryptCardDataIE=function(e,n,o,i,l,u){for(var c=(window.crypto||window.msCrypto).subtle,s=a(e,n,o,i,l),g={publicKey:'{ \t\t\t\t\t"kty" : "'+t.keyType+'", \t\t\t\t\t"extractable" : true, \t\t\t\t\t"n" : "'+t.modulus+'", \t\t\t\t\t"e" : "'+t.exponent+'", \t\t\t\t\t"alg" : "'+t.algorithm+'" \t\t\t\t}'},y=new Uint8Array(g.publicKey.length),d=0;d<g.publicKey.length;d+=1)y[d]=g.publicKey.charCodeAt(d);var p=c.importKey(t.keyFormat,y,t.algorithmParams,!0,t.keyOperations);p.onerror=function(e){console.error(e)},p.oncomplete=function(e){var a=e.target.result,n=c.encrypt(t.algorithmParams,a,s.buffer);n.onerror=function(e){console.error(e)},n.oncomplete=function(e){var a=new Uint8Array(e.target.result),n=r(a),o=t.version+n;u(o)}}},e.encryptCardData=function(t,r,a,n,o,i){window.navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./)?e.encryptCardDataIE(t,r,a,n,o,i):e.encryptCardDataOther(t,r,a,n,o).then((function(e){i(e)}),(function(e){console.log(e)}))}}(e.V001||(e.V001={}))}(e||(e={}));const t=e;jQuery((function(){(new class{listen(){let e=this;jQuery("body").on("change",'input[name="payment_method"]',(function(){jQuery("body").trigger("update_checkout")})),jQuery("body").on("updated_checkout",(function(t){e.afterpay(),e.afterpaynew(),e.bilink(),e.klarna()})),jQuery("#billing_company").on("input",(function(){e.bilink_toggle(jQuery(this).val()),jQuery("#buckaroo-afterpaynew-coc").parent().toggle(0!==jQuery.trim(jQuery(this).val()).length)})),jQuery("body").on("change","#buckaroo-in3-orderas",(function(){jQuery("#buckaroo-in3-coc-container, #buckaroo-in3-companyname-container").toggle("debtor"!==jQuery(this).val().toLowerCase())})),jQuery("body").on("change","#buckaroo-afterpay-b2b",(function(){let e=jQuery(this).is(":checked"),t=jQuery("#buckaroo-afterpay-birthdate"),r=t.parent(),a=jQuery('[name="buckaroo-afterpay-gender"]'),n=a.parent();jQuery("#showB2BBuckaroo").toggle(e),jQuery("#billing_company").length&&jQuery("#buckaroo-afterpay-CompanyName").val(jQuery("#billing_company").val()),e&&t.val("01-01-1900"),t.prop("disabled",!e),r.toggle(!e),r.toggleClass("validate-required",!e),a.prop("disabled",!e),n.toggle(!e)}))}afterpay(){jQuery("input[name=billing_phone]").length&&jQuery("#buckaroo-afterpay-phone").parent().hide()}afterpaynew(){jQuery("input[name=billing_phone]").length&&jQuery("#buckaroo-afterpaynew-phone").parent().hide(),jQuery("#buckaroo-afterpaynew-coc").parent().toggle(0!==jQuery.trim(jQuery("input[name=billing_company]").val()).length)}bilink(){let e=jQuery("#billing_company");e.length&&this.bilink_toggle(e.val())}bilink_toggle(e){let t=jQuery("#buckaroo_billink_b2b"),r=jQuery("#buckaroo_billink_b2c");if(t.length&&r.length){var a=jQuery.trim(e).length>0;t.toggle(a),r.toggle(!a)}}klarna(){jQuery("input[name=billing_phone]").length&&jQuery('input[id^="buckaroo-klarna"][type="tel"]').parent().hide()}}).listen(),(new class{form=jQuery("form[name=checkout]");validator=t.V001;listen(){let e=this.validator,t=this;this.form.on("input",".cardNumber",(function(r){t.toggleClasses(e.validateCardNumber(r.target.value),r.target)})),this.form.on("input",".cvc",(function(r){t.toggleClasses(e.validateCvc(r.target.value),r.target)})),this.form.on("input",".cardHolderName",(function(r){t.toggleClasses(e.validateCardholderName(r.target.value),r.target)})),this.form.on("input",".expirationYear",(function(r){t.toggleClasses(e.validateYear(r.target.value),r.target)})),this.form.on("input",".expirationMonth",(function(r){t.toggleClasses(e.validateMonth(r.target.value),r.target)})),this.form.submit(this.submit.bind(this))}toggleClasses(e,t){(t=jQuery(t)).toggleClass("error",!e),t.toggleClass("validated",e),this.submit()}submit(e){let r=jQuery('input[name="payment_method"]:checked').parent(),a=r.find(".cardNumber").val(),n=r.find(".cvc").val(),o=r.find(".cardHolderName").val(),i=r.find(".expirationYear").val(),l=r.find(".expirationMonth").val(),u=t.V001.validateCardNumber(a),c=t.V001.validateCvc(n),s=t.V001.validateCardholderName(o),g=t.V001.validateYear(i),y=t.V001.validateMonth(l);u&&c&&s&&g&&y&&this.getEncryptedData(a,i,l,n,o,r)}getEncryptedData(e,r,a,n,o,i){t.V001.encryptCardData(e,r,a,n,o,(function(e){i.find(".encryptedCardData").val(e)}))}}).listen(),(new class{listen(){const e=this;jQuery("#buckaroo-idin-verify-button").click((()=>{jQuery("#buckaroo-idin-issuer")&&jQuery("#buckaroo-idin-issuer").val().length>1?e.identify(jQuery("#buckaroo-idin-issuer").val()):e.displayErrorMessage(buckaroo_global.idin_i18n.bank_required)}))}disableBlock(e){jQuery(e).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}identify(e){const t=this;t.disableBlock(".checkout.woocommerce-checkout"),jQuery.ajax({url:buckaroo_global.ajax_url,data:{"wc-api":"WC_Gateway_Buckaroo_idin-identify",issuer:e},dataType:"json"}).done((e=>{jQuery(".woocommerce-checkout").unblock(),e&&e.message?t.displayErrorMessage(e.message):e&&"success"==e.result?window.location.replace(e.redirect):t.displayErrorMessage(buckaroo_global.idin_i18n.general_error)})).fail((()=>{t.displayErrorMessage(buckaroo_global.idin_i18n.general_error),jQuery(".woocommerce-checkout").unblock()}))}displayErrorMessage(e){const t=`      \n        <div class="woocommerce-error" role="alert">\n          ${e}\n        </div>\n      `;jQuery(".woocommerce-notices-wrapper").first().prepend(t);var r=jQuery(".woocommerce-notices-wrapper .woocommerce-error").first();setTimeout((function(){r.fadeOut(1e3)}),1e4),jQuery("html, body").scrollTop(0)}}).listen()}))})();